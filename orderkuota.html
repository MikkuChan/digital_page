<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Kuota • FadzDigital</title>
  <link rel="stylesheet" href="css/orderkuota.css" />
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <span class="logo">FDZ</span>
      <h1>Order Kuota</h1>
    </div>
  </header>

  <main class="container">
    <!-- Step 1: Nomor & Session -->
    <section class="card">
      <h2>1) Masukkan Nomor XL</h2>
      <div class="row">
        <label for="no_hp">Nomor HP</label>
        <div class="inline">
          <input id="no_hp" inputmode="numeric" placeholder="08xxxxxxxxxx" maxlength="14" />
          <button id="btnCheckSession" class="btn">Cek Session</button>
          <button id="btnLogout" class="btn btn-ghost" title="Hapus session nomor">Logout</button>
        </div>
        <small id="sessionInfo" class="muted"></small>
      </div>
    </section>

    <!-- Step 2: OTP -->
    <section class="card">
      <h2>2) Login OTP (Jika Belum Login)</h2>
      <div class="grid-2">
        <div>
          <label>Request OTP</label>
          <div class="inline">
            <button id="btnRequestOtp" class="btn">Kirim OTP</button>
            <small id="otpSentInfo" class="muted"></small>
          </div>
        </div>
        <div>
          <label>Verifikasi OTP</label>
          <div class="inline">
            <input id="kode_otp" inputmode="numeric" maxlength="6" placeholder="6 digit OTP" />
            <button id="btnVerifyOtp" class="btn">Verifikasi</button>
          </div>
          <small class="muted">OTP dikirim via SMS setelah tekan "Kirim OTP".</small>
        </div>
      </div>
    </section>

    <!-- Step 3: Katalog -->
    <section class="card">
      <h2>3) Pilih Paket</h2>
      <div class="toolbar">
        <button id="btnReloadCatalog" class="btn btn-ghost">Reload Katalog</button>
        <button id="btnCekPaketAktif" class="btn btn-ghost">Cek Paket Aktif</button>
      </div>
      <div id="catalog" class="catalog"></div>
    </section>

    <!-- Step 4: Pembayaran -->
    <section class="card">
      <h2>4) Pembayaran</h2>
      <div id="payPanel" class="pay-panel hidden">
        <div class="summary">
          <div><b>Paket:</b> <span id="sumPaket"></span></div>
          <div><b>Metode:</b> <span id="sumMetode"></span></div>
          <div><b>Harga:</b> <span id="sumHarga"></span></div>
        </div>
        <div class="inline">
          <button id="btnCreateInvoice" class="btn">Buat Invoice</button>
          <button id="btnCancelSelection" class="btn btn-ghost">Batal</button>
        </div>
        <small class="muted">Invoice berlaku ±60 menit. Setelah bayar sukses, sistem akan otomatis proses ke upstream.</small>
      </div>

      <div id="invoicePanel" class="invoice-panel hidden">
        <div class="row">
          <label>Payment URL</label>
          <p><a id="paymentUrl" href="#" target="_blank" rel="noopener">Buka halaman pembayaran</a></p>
        </div>
        <div class="row">
          <label>Status</label>
          <p id="statusText" class="status-pill">PENDING</p>
          <button id="btnRefreshStatus" class="btn btn-ghost">Refresh Status</button>
        </div>
        <div id="resultPanel" class="result-panel hidden">
          <h3>Hasil Forward Upstream</h3>
          <div id="deeplinkWrap" class="hidden">
            <p>Deeplink:</p>
            <p><a id="deeplinkUrl" target="_blank" rel="noopener">Buka aplikasi e-wallet</a></p>
          </div>
          <div id="qrisWrap" class="hidden">
            <p>QRIS:</p>
            <img id="qrisImg" alt="QRIS" />
            <pre id="qrisText" class="code"></pre>
            <small class="muted">Jika gambar tidak muncul, scan via teks QR di atas (copy & paste ke aplikasi pembaca QR).</small>
          </div>
          <div class="row">
            <button id="btnCekPaketAktif2" class="btn btn-ghost">Cek Paket Aktif Lagi</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Step 5: Paket Aktif -->
    <section class="card">
      <h2>5) Paket Aktif</h2>
      <div id="activePackages" class="active-packages">
        <div class="empty">Belum ada data. Klik "Cek Paket Aktif".</div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <small>© <span id="year"></span> FadzDigital • versi FE-kuota</small>
  </footer>

  <div id="toast" class="toast"></div>
  <div id="spinner" class="spinner hidden">Loading…</div>

  <script src="js/orderkuota.js" defer></script>
</body>
</html>
